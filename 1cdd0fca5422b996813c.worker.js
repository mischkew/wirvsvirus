!function(t){var e={};function i(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(r,n,function(e){return t[e]}.bind(null,n));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/wirvsvirus/",i(i.s=1)}([function(t,e,i){t.exports=function t(e,i,r){function n(o,u){if(!i[o]){if(!e[o]){if(a)return a(o,!0);var s=new Error("Cannot find module '"+o+"'");throw s.code="MODULE_NOT_FOUND",s}var h=i[o]={exports:{}};e[o][0].call(h.exports,(function(t){var i=e[o][1][t];return n(i||t)}),h,h.exports,t,e,i,r)}return i[o].exports}for(var a=!1,o=0;o<r.length;o++)n(r[o]);return n}({1:[function(t,e,i){var r,n,a,o,u,s={}.hasOwnProperty;r=t("./PriorityQueue/AbstractPriorityQueue"),n=t("./PriorityQueue/ArrayStrategy"),o=t("./PriorityQueue/BinaryHeapStrategy"),a=t("./PriorityQueue/BHeapStrategy"),(u=function(t){function e(t){t||(t={}),t.strategy||(t.strategy=o),t.comparator||(t.comparator=function(t,e){return(t||0)-(e||0)}),e.__super__.constructor.call(this,t)}return function(t,e){for(var i in e)s.call(e,i)&&(t[i]=e[i]);function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype}(e,t),e}(r)).ArrayStrategy=n,u.BinaryHeapStrategy=o,u.BHeapStrategy=a,e.exports=u},{"./PriorityQueue/AbstractPriorityQueue":2,"./PriorityQueue/ArrayStrategy":3,"./PriorityQueue/BHeapStrategy":4,"./PriorityQueue/BinaryHeapStrategy":5}],2:[function(t,e,i){e.exports=function(){function t(t){var e;if(null==(null!=t?t.strategy:void 0))throw"Must pass options.strategy, a strategy";if(null==(null!=t?t.comparator:void 0))throw"Must pass options.comparator, a comparator";this.priv=new t.strategy(t),this.length=(null!=t&&null!=(e=t.initialValues)?e.length:void 0)||0}return t.prototype.queue=function(t){this.length++,this.priv.queue(t)},t.prototype.dequeue=function(t){if(!this.length)throw"Empty queue";return this.length--,this.priv.dequeue()},t.prototype.peek=function(t){if(!this.length)throw"Empty queue";return this.priv.peek()},t.prototype.clear=function(){return this.length=0,this.priv.clear()},t}()},{}],3:[function(t,e,i){var r;r=function(t,e,i){var r,n,a;for(n=0,r=t.length;n<r;)i(t[a=n+r>>>1],e)>=0?n=a+1:r=a;return n},e.exports=function(){function t(t){var e;this.options=t,this.comparator=this.options.comparator,this.data=(null!=(e=this.options.initialValues)?e.slice(0):void 0)||[],this.data.sort(this.comparator).reverse()}return t.prototype.queue=function(t){var e;e=r(this.data,t,this.comparator),this.data.splice(e,0,t)},t.prototype.dequeue=function(){return this.data.pop()},t.prototype.peek=function(){return this.data[this.data.length-1]},t.prototype.clear=function(){this.data.length=0},t}()},{}],4:[function(t,e,i){e.exports=function(){function t(t){var e,i,r,n,a,o,u,s;for(this.comparator=(null!=t?t.comparator:void 0)||function(t,e){return t-e},this.pageSize=(null!=t?t.pageSize:void 0)||512,this.length=0,u=0;1<<u<this.pageSize;)u+=1;if(1<<u!==this.pageSize)throw"pageSize must be a power of two";for(this._shift=u,this._emptyMemoryPageTemplate=e=[],i=0,a=this.pageSize;0<=a?i<a:i>a;0<=a?++i:--i)e.push(null);if(this._memory=[],this._mask=this.pageSize-1,t.initialValues)for(r=0,n=(o=t.initialValues).length;r<n;r++)s=o[r],this.queue(s)}return t.prototype.queue=function(t){this.length+=1,this._write(this.length,t),this._bubbleUp(this.length,t)},t.prototype.dequeue=function(){var t,e;return t=this._read(1),e=this._read(this.length),this.length-=1,this.length>0&&(this._write(1,e),this._bubbleDown(1,e)),t},t.prototype.peek=function(){return this._read(1)},t.prototype.clear=function(){this.length=0,this._memory.length=0},t.prototype._write=function(t,e){var i;for(i=t>>this._shift;i>=this._memory.length;)this._memory.push(this._emptyMemoryPageTemplate.slice(0));return this._memory[i][t&this._mask]=e},t.prototype._read=function(t){return this._memory[t>>this._shift][t&this._mask]},t.prototype._bubbleUp=function(t,e){var i,r,n,a;for(i=this.comparator;t>1&&(r=t&this._mask,t<this.pageSize||r>3?n=t&~this._mask|r>>1:r<2?(n=t-this.pageSize>>this._shift,n+=n&~(this._mask>>1),n|=this.pageSize>>1):n=t-2,!(i(a=this._read(n),e)<0));)this._write(n,e),this._write(t,a),t=n},t.prototype._bubbleDown=function(t,e){var i,r,n,a,o;for(o=this.comparator;t<this.length;)if(t>this._mask&&!(t&this._mask-1)?i=r=t+2:t&this.pageSize>>1?(i=(t&~this._mask)>>1,r=1+(i=1+(i|=t&this._mask>>1)<<this._shift)):r=(i=t+(t&this._mask))+1,i!==r&&r<=this.length)if(n=this._read(i),a=this._read(r),o(n,e)<0&&o(n,a)<=0)this._write(i,e),this._write(t,n),t=i;else{if(!(o(a,e)<0))break;this._write(r,e),this._write(t,a),t=r}else{if(!(i<=this.length))break;if(!(o(n=this._read(i),e)<0))break;this._write(i,e),this._write(t,n),t=i}},t}()},{}],5:[function(t,e,i){e.exports=function(){function t(t){var e;this.comparator=(null!=t?t.comparator:void 0)||function(t,e){return t-e},this.length=0,this.data=(null!=(e=t.initialValues)?e.slice(0):void 0)||[],this._heapify()}return t.prototype._heapify=function(){var t,e,i;if(this.data.length>0)for(t=e=1,i=this.data.length;1<=i?e<i:e>i;t=1<=i?++e:--e)this._bubbleUp(t)},t.prototype.queue=function(t){this.data.push(t),this._bubbleUp(this.data.length-1)},t.prototype.dequeue=function(){var t,e;return e=this.data[0],t=this.data.pop(),this.data.length>0&&(this.data[0]=t,this._bubbleDown(0)),e},t.prototype.peek=function(){return this.data[0]},t.prototype.clear=function(){this.length=0,this.data.length=0},t.prototype._bubbleUp=function(t){for(var e,i;t>0&&(e=t-1>>>1,this.comparator(this.data[t],this.data[e])<0);)i=this.data[e],this.data[e]=this.data[t],this.data[t]=i,t=e},t.prototype._bubbleDown=function(t){var e,i,r,n,a;for(e=this.data.length-1;n=1+(i=1+(t<<1)),r=t,i<=e&&this.comparator(this.data[i],this.data[r])<0&&(r=i),n<=e&&this.comparator(this.data[n],this.data[r])<0&&(r=n),r!==t;)a=this.data[r],this.data[r]=this.data[t],this.data[t]=a,t=r},t}()},{}]},{},[1])(1)},function(t,e,i){"use strict";function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}function n(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t)){var i=[],r=!0,n=!1,a=void 0;try{for(var o,u=t[Symbol.iterator]();!(r=(o=u.next()).done)&&(i.push(o.value),!e||i.length!==e);r=!0);}catch(s){n=!0,a=s}finally{try{r||null==u.return||u.return()}finally{if(n)throw a}}return i}}(t,e)||function(t,e){if(t){if("string"===typeof t)return r(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(i):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?r(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}i.r(e),i.d(e,"setupSimulation",(function(){return O})),i.d(e,"runSimulation",(function(){return j})),i.d(e,"destroySimulation",(function(){return x}));function a(t,e){return t-e+2*Math.random()*e}function o(t,e){var i,r={};return r.station=(i=e)[Math.floor(Math.random()*i.length)],r.name=t.name,r.probability=a(t.probability.value,t.probability.variance),r.stay_until=Math.floor(function(t,e){var i=a(t%100+60*Math.floor(t/100),e%100+60*Math.floor(e/100));return 100*Math.floor(i/60)+i%60}(t.stay_until.time,t.stay_until.variance)),r}function u(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function s(t,e){var i=[],r=new Set,n=u({},t,null);r.add(t),i.push(t);for(var a=function(){var t=i.shift();if(void 0===e[t])throw new Error("Station ".concat(t," not in station list. Type: ").concat(typeof t));e[t].next_stops.forEach((function(e){r.has(e)||(n[e]=t,r.add(e),i.push(e))}))};i.length>0;)a();return Object.keys(n).length,Object.keys(e).length,n}function h(t,e){for(var i=e,r=[];null!==i;)if(r.unshift(i),void 0===(i=t[i]))throw new Error("Graph is not connected! Maybe there is an unidirectional edge?");return r}function c(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function l(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function p(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function f(t,e,i){return e&&p(t.prototype,e),i&&p(t,i),t}var d=i(0),y=i.n(d);function m(t,e){return t.day<e.day?-1:t.day>e.day?1:t.time-e.time}var v=function(){function t(){l(this,t),this.queue=this.travel_queue=new y.a({comparator:m,strategy:y.a.BinaryHeapStrategy})}return f(t,[{key:"enqueue",value:function(t){var e=t.item,i=t.day,r=t.time;this.queue.queue({item:e,day:i,time:r})}},{key:"dequeueExpired",value:function(t,e,i){for(;this.queue.length>0&&this.queue.peek().day===t&&this.queue.peek().time<=e;){i(this.queue.dequeue().item)}}}]),t}(),_=function(){function t(e){var i=e.status,r=e.schedule,n=e.current_station,a=e.current_schedule,o=e.state,u=e.path,s=e.path_position,h=e.sim;l(this,t),this.status=i,this.schedule=r,this.current_station=n,this.current_schedule=a,this.state=o,this.path=u,this.path_position=s,this.sim=h}return f(t,[{key:"arriveAtNextPathStop",value:function(){var t=this;this.state=0,this.advancePath({onNext:function(){t.sim.actorWaitsForDeparture({actor:t,station:t.current_station,destination:t.nextPathStop()})},onArrivedAtDestination:function(){t.arriveAtScheduleLocation()}})}},{key:"arriveAtScheduleLocation",value:function(){this.currentScheduleExpired()&&this.advanceSchedule(),this.sim.scheduleWait(this,this.schedule[this.current_schedule].stay_until)}},{key:"currentScheduleExpired",value:function(){return 0!==this.current_schedule&&this.schedule[this.current_schedule].time<this.sim.time}},{key:"stayFinished",value:function(){var t=this;this.advanceSchedule(),this.preparePath({onAlreadyThere:function(){t.arriveAtScheduleLocation()},onPrepared:function(){t.sim.actorWaitsForDeparture({actor:t,station:t.current_station,destination:t.nextPathStop()})}})}},{key:"_cycleSchedule",value:function(){this.current_schedule===this.schedule.length-1?this.current_schedule=0:this.current_schedule+=1}},{key:"advanceSchedule",value:function(){for(this._cycleSchedule();this.currentScheduleExpired();)this._cycleSchedule()}},{key:"advancePath",value:function(t){var e=t.onNext,i=t.onArrivedAtDestination;this.path_position+=1,this.current_station=this.path[this.path_position],this.path_position===this.path.length-1?(this.path=null,this.path_position=null,i()):e()}},{key:"preparePath",value:function(t){var e=t.onAlreadyThere,i=t.onPrepared,r=this.schedule[this.current_schedule].station;r!==this.current_station?(this.path=h(this.sim.predecessorMaps[this.current_station],r),this.path_position=0,i()):e()}},{key:"nextPathStop",value:function(){return null===this.path||this.path_position===this.path.length-1?null:this.path[this.path_position+1]}},{key:"tryInfect",value:function(t){return 0===this.status&&t>Math.random()}}]),t}();function g(t,e){return t.map((function(t){return new _(function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?c(Object(i),!0).forEach((function(e){u(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):c(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({},t,{sim:e}))}))}var b=function(){function t(e,i,r){l(this,t),this.stations=e,this.actors=g(i,this),this.predecessorMaps=r,this.time=360,this.day=0,this.travel_queue=new v,this.idle_queue=new v,this.recover_queue=new v,this.station_queues=Object.fromEntries(Object.entries(e).map((function(t){var e=n(t,2),i=e[0],r=e[1];return[i,Object.fromEntries(r.next_stops.map((function(t){return[t,[]]})))]}))),this.tick=0,this.arrivalCallback=function(){},this.finishStayCallback=function(){},this.waitCallback=function(){}}return f(t,[{key:"startActors",value:function(){this.actors.forEach((function(t){t.arriveAtScheduleLocation()}))}},{key:"onNextDay",value:function(){this.day+=1}},{key:"stepTime",value:function(){this.tick=this.tick+1;var t=!1;return this.tick>=1&&(this.time=this.time+1,this.tick=0,t=!0),1440===this.time&&(this.time=0,this.onNextDay()),t}},{key:"actorWaitsForDeparture",value:function(t){var e=t.actor,i=t.station,r=t.destination;this.station_queues[i][r].push(e)}},{key:"scheduleWait",value:function(t,e){var i=function(t){return 60*Math.floor(t/100)+t%100}(e),r={item:t,day:this.day+(i<=this.time),time:i};this.idle_queue.enqueue(r),this.waitCallback(t,r.day,r.time)}},{key:"infect",value:function(t){t.status=1,this.recover_queue.enqueue({item:t,day:this.day+2,time:this.time})}},{key:"handleInfectionTrigger",value:function(t){var e=this,i=t.reduce((function(t,e){return t+(1===e.status?1:0)}),0)/t.length*.5;i>1&&(i=1),t.forEach((function(t){t.tryInfect(i)&&e.infect(t)}))}},{key:"step",value:function(){var t=this;return this.stepTime()?(this.idle_queue.dequeueExpired(this.day,this.time,(function(e){e.stayFinished(),t.finishStayCallback(e,e.current_station,e.nextPathStop(),e.schedule[e.current_schedule].name)})),this.travel_queue.dequeueExpired(this.day,this.time,(function(e){e.forEach((function(e){e.arriveAtNextPathStop(),t.arrivalCallback(e)}))})),this.recover_queue.dequeueExpired(this.day,this.time,(function(t){t.status=2})),this.time%10===0&&Object.entries(this.station_queues).forEach((function(e){var i=n(e,2),r=(i[0],i[1]);Object.entries(r).forEach((function(e){var i=n(e,2),a=i[0],o=i[1];o.length>0&&(o.forEach((function(t){t.state=1})),t.travel_queue.enqueue({day:t.day+Math.floor((t.time+10)/1440),time:(t.time+10)%1440,item:o}),t.handleInfectionTrigger(o),r[a]=[])}))})),this.actors):this.actors}}]),t}(),S=null,k=null,w=null,P=null,q=!1;function O(t,e){if(null!==S||null!==k||null!==w||null!==P)throw new Error("Simulation already setup. Destroy simulation first via `destroySimulation`.");S=function(t,e){var i=Object.keys(e);return Array.from(Array(t.count).keys()).map((function(e){var r=t.schedule.reduce((function(t,e){var r=o(e,i);return Math.random()<r.probability&&t.push(r),t}),[]);return{status:0,schedule:r,current_station:r[0].station,current_schedule:0,state:0,path:null,path_position:null}}))}(t,e),k=function(t){var e={};return Object.keys(t).forEach((function(i,r,n){e[i]=s(i,t)})),e}(e),(w=new b(e,S,k)).infect(w.actors[0]),w.startActors(),P=new Map(Object.entries(e).map((function(t){var e=n(t,2),i=e[0],r=e[1];return[i,[r.lat,r.lng]]})))}function j(t){if(void 0===t&&(t=1),q)throw new Error("Simulation is already running. Destroy simulation first via `destroySimulation`");q=!0;var e=0;!function i(){q&&requestAnimationFrame(i);var r=w.step();if(++e>=t){e=0;var n=function(t){var e=t.map((function(t){var e=null,i=null;return 1===t.state?(e=t.path[t.path_position],i=t.path[t.path_position+1]):i=e=t.current_station,[P.get(e),P.get(i),0===t.state?1:0,t.status]}));return[w.day,w.time,e]}(r);postMessage(n)}}()}function x(){q=!1,S=null,k=null,w=null,P=null}addEventListener("message",(function(t){var i,r=t.data,n=r.type,a=r.method,o=r.id,u=r.params;"RPC"===n&&a&&((i=e[a])?Promise.resolve().then((function(){return i.apply(e,u)})):Promise.reject("No such method")).then((function(t){postMessage({type:"RPC",id:o,result:t})})).catch((function(t){var e={message:t};t.stack&&(e.message=t.message,e.stack=t.stack,e.name=t.name),postMessage({type:"RPC",id:o,error:e})}))})),postMessage({type:"RPC",method:"ready"})}]);
//# sourceMappingURL=1cdd0fca5422b996813c.worker.js.map